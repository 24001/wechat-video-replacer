# 完全清理安装指南

## 🚨 当前问题

**症状**：
- ✅ "系统诊断" 能找到微信
- ❌ "一键替换" 找不到微信
- 但代码完全相同！

**原因**：旧版本 IPA 包含了 roothelper（70KB），导致应用状态混乱

## ✅ 解决方案

### 步骤1：完全卸载（必须）

1. **打开 TrollStore**
2. **找到 "微信视频替换工具" 或 "WechatVideoReplacer"**
3. **点击卸载**
4. **确认卸载完成**

### 步骤2：重启设备（关键！）

**为什么必须重启？**
- 清除 iOS 系统的权限缓存
- 重置应用沙盒状态
- 刷新 TrollStore 的应用管理状态

**如何重启：**
```
长按电源键 → 滑动关机 → 等待 10 秒 → 长按电源键开机
```

### 步骤3：确认新版本

**检查 IPA 文件：**
```bash
位置：/Users/slwl/bc/微信开发/视频测试/WechatVideoReplacer/build/WechatVideoReplacer.ipa
大小：67KB（之前是 73KB 或更大）
```

**验证特征：**
- ✅ 没有 roothelper
- ✅ Makefile 输出显示 "No RootHelper needed"
- ✅ 使用直接访问方式

### 步骤4：全新安装

1. **通过 TrollStore 安装新的 IPA**
2. **打开应用**
3. **先测试"系统诊断"** → 应该成功
4. **再测试"一键替换"** → 现在应该也能找到微信了！

---

## 🔍 如果还是失败

如果重启后还是失败，请：

### 1. 查看 Console 日志

新版本包含详细日志，查看：
```
Xcode → Window → Devices and Simulators → 选择设备 → Open Console
搜索：WechatVideoReplacer
```

或者使用系统 Console.app。

### 2. 提供完整日志

点击"一键替换"后，找到日志中的：
```
================================================================================
🚀 ========== 开始一键替换流程 ==========
================================================================================

📝 [步骤1] 验证素材...
✅ [步骤1] 成功：...

📝 [步骤2A] 在主线程获取微信容器路径...
❌ [步骤2A] 失败：无法获取微信容器路径

🔍 运行完整诊断...
   [这里会有详细的错误信息]
================================================================================
```

把从开始到结束的完整日志复制出来。

### 3. 检查关键信息

在诊断输出中查看：
- **路径存在**：true/false
- **是目录**：true/false
- **读取失败错误码**：具体是什么错误

---

## 🎯 预期结果

正确安装后，日志应该是：
```
================================================================================
🚀 ========== 开始一键替换流程 ==========
================================================================================

📝 [步骤1] 验证素材...
✅ [步骤1] 成功：素材已选择

📝 [步骤2A] 在主线程获取微信容器路径...
✅ [步骤2A] 成功：获取到微信容器路径
   - 路径: /var/mobile/Containers/Data/Application/.../tmp

📝 [步骤2B] 从相册导出视频（后台线程）...
✅ [步骤2B] 成功：视频导出完成

... (后续步骤)
```

---

## 📋 清理检查清单

- [ ] 已在 TrollStore 中卸载旧版本
- [ ] 已重启设备
- [ ] 确认新 IPA 是 67KB
- [ ] 通过 TrollStore 安装新版本
- [ ] "系统诊断"测试通过
- [ ] "一键替换"现在能找到微信容器

---

**核心要点**：旧版本的 roothelper 造成了状态污染，必须完全卸载 + 重启才能清除！
