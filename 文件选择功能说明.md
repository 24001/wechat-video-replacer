# 文件选择功能 - 支持微信接收的视频

## 🎉 新功能

**版本**：v1.2 (78KB)  
**新增**：文件选择器，支持选择任何位置的视频文件

## 🆚 两种选择方式

现在点击 **"选择素材"** 按钮会显示选择菜单：

### 📱 从相册选择（原功能）
- 选择照片库中保存的视频
- 自动获取视频时长和详细信息
- 适合：拍摄的视频、保存到相册的视频

### 📁 从文件选择（新功能）
- 选择设备上任何位置的视频文件
- 支持微信接收的视频、下载的视频等
- 通过 iOS 文件选择器访问

## 📂 文件选择器支持的位置

### 1. 微信文件
- 微信聊天中接收的视频
- 路径：**文件 → 浏览 → 微信 → 找到视频文件**

### 2. 其他应用文件
- Safari 下载的视频
- 其他应用分享的视频
- 邮件附件视频

### 3. 云存储
- iCloud Drive
- OneDrive、Dropbox 等（如果已安装）

### 4. 本地文件
- "我的 iPhone" 中的视频文件

## 🎯 使用流程

### 选择微信接收的视频

1. **点击 "选择素材"**
2. **选择 "📁 从文件选择"**
3. **导航到微信文件夹**：
   ```
   浏览 → 微信 → [聊天记录] → [找到视频文件]
   ```
4. **点击选择视频文件**
5. **确认选择**

### 选择其他视频文件

1. **点击 "选择素材"**
2. **选择 "📁 从文件选择"**
3. **浏览到文件位置**：
   - iCloud Drive
   - 我的 iPhone
   - 其他云存储
4. **选择视频文件**

## 📝 技术实现

### 文件访问权限
- 使用 iOS `UIDocumentPickerViewController`
- 自动处理安全范围资源访问
- 支持所有常见视频格式（.mp4, .mov, .avi 等）

### 处理流程
```
文件选择 → 安全访问 → 复制到临时目录 → 正常替换流程
```

### 与相册选择的区别

| 特性 | 📱 相册选择 | 📁 文件选择 |
|------|-----------|-----------|
| **数据源** | PHAsset (照片库) | 文件系统 |
| **时长获取** | ✅ 自动获取 | ❌ 显示 0:00 |
| **文件大小** | ✅ 精确 | ✅ 精确 |
| **支持范围** | 仅相册视频 | 所有视频文件 |
| **微信接收视频** | ❌ 不支持 | ✅ 完全支持 |

### 特殊标识

文件选择的视频会用特殊标识保存：
```
assetIdentifier: "file:///var/mobile/..."
```

这样系统就知道要从文件导出而不是从相册导出。

## 🔧 错误处理

### 常见错误

1. **"无法访问安全范围资源"**
   - 原因：iOS 文件权限问题
   - 解决：重新选择文件

2. **"文件不存在"**
   - 原因：文件可能已被删除或移动
   - 解决：确认文件仍然存在

3. **"无法读取文件信息"**
   - 原因：文件损坏或格式不支持
   - 解决：选择其他视频文件

## 📊 日志输出

文件选择会输出详细日志：

```
📁 [Files] 选择文件: video.mp4
   - 路径: /var/mobile/Containers/Data/...
📁 [VideoViewModel] 文件视频已保存
   - 路径: /path/to/video.mp4
   - 大小: 15728640 bytes
📁 [VideoService] 从文件导出: /path/to/video.mp4
✅ [VideoService] 文件复制成功
   - 源文件: video.mp4
   - 临时文件: /var/tmp/video_1699...
```

## 💡 最佳实践

### 1. 微信视频替换
1. **在微信中找到要替换的视频**
2. **长按视频 → 保存到文件（可选）**
3. **或直接从聊天记录中选择**
4. **在我们的应用中选择该文件**
5. **执行替换**

### 2. 大文件处理
- 文件选择器支持大视频文件
- 复制到临时目录可能需要一些时间
- 确保设备有足够存储空间

### 3. 文件格式
- 支持所有 iOS 支持的视频格式
- 推荐：MP4, MOV
- 避免：过于特殊的格式

---

## 🎯 总结

现在你可以：
- ✅ **选择相册中的视频**（原功能）
- ✅ **选择微信接收的视频**（新功能）
- ✅ **选择任何位置的视频文件**（新功能）
- ✅ **完整的替换流程**（已修复）

**版本**：v1.2 (78KB)  
**构建时间**：2025-11-11 01:04  
**新增功能**：文件选择器支持

终于可以处理微信接收的视频了！🎉
